<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_client_script">
    <sys_ux_client_script action="INSERT_OR_UPDATE">
        <controller_preset/>
        <includes/>
        <macroponent display_value="Default">72067896835a32104acac396feaad362</macroponent>
        <name>On Record Watcher Events</name>
        <preset/>
        <required_translations>[
    {
        "message": "This article was drafted by Now Assist. Be sure to review it for accuracy before saving."
    }
]</required_translations>
        <script><![CDATA[/**
 * @param {params} params
 * @param {api} params.api
 * @param {any} params.event
 * @param {any} params.imports
 * @param {ApiHelpers} params.helpers
 */
async function handler({
    api,
    event,
    helpers,
    imports
}) {
    if (event.name === 'RECORD_WATCHER#MESSAGE_RECEIVED') {
        if (api.state.isGenAiTimedOut) {
            // TODO: send Gen AI feedback = Ignored
            return;
        }

        api.setState('isGenAiGenerating', false);
        helpers.timing.clearTimeout(api.state.genAiTimeoutId);
        var response = JSON.parse(event.payload.data.record.gen_ai_response.value);
        for (var key in response.outputFields) {
            api.emit('GEN_AI_SET_FIELD', {
                fieldName: key,
                value: response.outputFields[key]
            });
        }
        api.emit("NOW_UXF_PAGE#ADD_NOTIFICATIONS", {
            items: [{
                id: "na_drafted",
                status: "moderate",
                icon: "ai-sparkle-fill",
                content: await helpers.translate("This article was drafted by Now Assist. Be sure to review it for accuracy before saving."),
                action: {
                    type: "dismiss"
                }
            }]
        });
        api.setState('isGenAiGenerated', true);
        api.emit("NOW_UXF_PAGE#REMOVE_NOTIFICATIONS", {
            items: [{
                id: "na_drafting"
            }]
        });
        helpers.modal.close("modal_gen_ai");
        var selectedRecords = [];
        if (api.state.genAiSourceRecordId != null && api.state.genAiSourceRecordId.trim().length > 0) {
            selectedRecords.push(api.state.genAiSourceRecordId);
        }
        if (api.state.filteredSelectedTasks) {
            for (var id in api.state.filteredSelectedTasks) {
                selectedRecords.push(id);
            }
        }
        api.setState('telemetryPayload', {
            event_key: 'taskList',
            targetTableSysId: api.data.record.sysId,
            selectedRecords: selectedRecords
        });
        api.setState('isTelemetryExecuting', true);
    }
    
}]]></script>
        <script_api_version>2.0.0</script_api_version>
        <sys_class_name>sys_ux_client_script</sys_class_name>
        <sys_created_by>Omar</sys_created_by>
        <sys_created_on>2026-01-09 17:04:53</sys_created_on>
        <sys_id>1f067896835a32104acac396feaad38b</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>On Record Watcher Events</sys_name>
        <sys_package display_value="Facility Issue Reporting System " source="x_1850913_facili_0">1cf4c9a3833d32104acac396feaad3c1</sys_package>
        <sys_policy/>
        <sys_scope display_value="Facility Issue Reporting System ">1cf4c9a3833d32104acac396feaad3c1</sys_scope>
        <sys_update_name>sys_ux_client_script_1f067896835a32104acac396feaad38b</sys_update_name>
        <sys_updated_by>Omar</sys_updated_by>
        <sys_updated_on>2026-01-09 17:04:53</sys_updated_on>
        <target>macroponent</target>
        <type>default</type>
    </sys_ux_client_script>
</record_update>
